<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulace ubytování</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body { background: #f5f5f5; font-family: 'Roboto', sans-serif; }
    .card { margin-bottom: 1rem; border-radius: .5rem; }
    .recap-table td:first-child { font-weight: 500; }
    .form-label i { vertical-align: middle; margin-right: .5rem; color: #6c757d; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="mb-4">Kalkulace ubytování</h1>
    <div class="row gy-3">
      <div class="col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label"><i class="material-icons">calendar_month</i>Termín</label>
              <input type="text" id="daterange" class="form-control" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="material-icons">apartment</i>Apartmán</label><br>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="apartment" id="aptA" value="A" checked>
                <label class="form-check-label" for="aptA">Apartmán A</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="apartment" id="aptB" value="B">
                <label class="form-check-label" for="aptB">Apartmán B</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="apartment" id="aptAB" value="AB">
                <label class="form-check-label" for="aptAB">Oba apartmány</label>
              </div>
              <div class="mt-2 text-muted">Kapacita: <span id="capacityDisplay">11+7</span></div>
            </div>
            <div class="row">
              <div class="col-4 mb-3">
                <label class="form-label"><i class="material-icons">people</i>Dospělí</label>
                <select id="adultCount" class="form-select"></select>
              </div>
              <div class="col-4 mb-3">
                <label class="form-label"><i class="material-icons">child_care</i>Děti (3–15)</label>
                <select id="childCount" class="form-select"></select>
              </div>
              <div class="col-4 mb-3">
                <label class="form-label"><i class="material-icons">pets</i>Mazlíčci</label>
                <select id="petsCount" class="form-select">
                  <option>0</option><option>1</option><option>2</option><option>3</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Rekapitulace</h5>
            <table class="table recap-table">
              <tbody>
                <tr><td>Apartmán</td><td class="text-end" id="sumApartment">–</td></tr>
                <tr><td>Termín</td><td class="text-end" id="sumTerm">–</td></tr>
                <tr><td>Počet nocí</td><td class="text-end" id="sumNights">–</td></tr>
                <tr><td>Osoby celkem</td><td class="text-end" id="sumPeople">–</td></tr>
                <tr><td> - Dospělí</td><td class="text-end" id="sumAdults">–</td></tr>
                <tr><td> - Děti</td><td class="text-end" id="sumChildren">–</td></tr>
                <tr><td>Mazlíčci</td><td class="text-end" id="sumPets">–</td></tr>
              </tbody>
            </table>
            <h4 class="text-end">Cena pobytu: <span id="totalPrice">0 CZK</span></h4>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
  <script>
    $(function() {
      const holidays = ['01-01','05-08','07-05','07-06','09-28','10-28','11-17','04-04','04-05','05-01'];
      $('#daterange').daterangepicker({ locale:{format:'DD.MM.YYYY'}, startDate: moment().add(1,'days'), endDate: moment().add(3,'days') });

      $('input[name="apartment"]').change(updateCounts);
      $('#daterange').on('apply.daterangepicker', recalc);
      $('#petsCount').on('change', recalc);

      function updateCounts(){
        const apt = $('input[name="apartment"]:checked').val();
        let cap = apt === 'A' ? 11 : apt === 'B' ? 6 : 17;
        let extra = apt === 'A' ? 7 : apt === 'B' ? 2 : 9;
        $('#capacityDisplay').text(cap + '+' + extra);
        const maxTotal = cap + extra;

        // Populate adult select
        const prevAdults = +$('#adultCount').val() || 0;
        $('#adultCount').empty();
        for(let i = 0; i <= maxTotal; i++) $('#adultCount').append(new Option(i, i));
        $('#adultCount').val(Math.min(prevAdults, maxTotal));

        // Populate child select
        const prevChildren = +$('#childCount').val() || 0;
        $('#childCount').empty();
        for(let i = 0; i <= maxTotal; i++) $('#childCount').append(new Option(i, i));
        $('#childCount').val(Math.min(prevChildren, maxTotal - $('#adultCount').val()));

        // Adjust on change to enforce sum constraint
        $('#adultCount').off('change').on('change', function(){
          const adults = +this.value;
          const childMax = maxTotal - adults;
          const prevChild = +$('#childCount').val() || 0;
          $('#childCount').empty();
          for(let i = 0; i <= childMax; i++) $('#childCount').append(new Option(i, i));
          $('#childCount').val(Math.min(prevChild, childMax));
          recalc();
        });
        $('#childCount').off('change').on('change', function(){
          const children = +this.value;
          const adultMax = maxTotal - children;
          const prevAdult = +$('#adultCount').val() || 0;
          $('#adultCount').empty();
          for(let i = 0; i <= adultMax; i++) $('#adultCount').append(new Option(i, i));
          $('#adultCount').val(Math.min(prevAdult, adultMax));
          recalc();
        });

        recalc();
      }

      function recalc(){
        const apt = $('input[name="apartment"]:checked').val();
        const term = $('#daterange').val();
        const nights = moment(term.split(' - ')[1],'DD.MM.YYYY').diff(moment(term.split(' - ')[0],'DD.MM.YYYY'),'days');
        const adults = +$('#adultCount').val();
        const children = +$('#childCount').val();
        const ppl = adults + children;
        const pets = +$('#petsCount').val();

        let total = 0;
        for(let d = moment(term.split(' - ')[0],'DD.MM.YYYY'); d.isBefore(moment(term.split(' - ')[1],'DD.MM.YYYY')); d.add(1,'days')){
          const m = d.format('MM-DD'), wd = d.day();
          let rate = (wd === 5 || wd === 6) ? 650 : 550;
          if(holidays.includes(m)) rate = 650;
          total += rate * ppl + pets * 300;
        }

        $('#sumApartment').text(apt);
        $('#sumTerm').text(term);
        $('#sumNights').text(nights);
        $('#sumPeople').text(ppl);
        $('#sumAdults').text(adults);
        $('#sumChildren').text(children);
        $('#sumPets').text(pets);
        $('#totalPrice').text(total.toLocaleString() + ' CZK');
      }

      updateCounts();
    });
  </script>
</body>
</html>
