<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulace ubytov√°n√≠</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Barvy a typografie */
    :root {
      --primary: #0d6efd;
      --muted: #adb5bd;
      --text: #212529;
    }

    body {
      background: #e9ecef;
      color: var(--text);
      font-family: 'Roboto', sans-serif;
    }

    h1,
    .card-title {
      font-weight: 600;
      color: var(--text);
    }

    /* Karty a formul√°≈ô */
    .card {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: .5rem;
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: #495057;
    }

    .form-label i {
      margin-right: .5rem;
    }

    .form-check-input {
      accent-color: var(--primary);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 .25rem rgba(133, 67, 3, 0.25);
    }

    .text-muted {
      color: #6c757d !important;
    }

    /* Rekapitulace */
    .recap-table th,
    .recap-table td.in-range {
      border-top: none;
      color: var(--text);
    }

    .recap-table th {
      font-weight: 500;
      color: #343a40;
    }

    #totalPrice {
      color: #dc3545;
      font-weight: 600;
    }

    /* Datepicker */
    .daterangepicker td.off {
      visibility: hidden;
      /* Skryt√≠ obsahu, zachov√° strukturu m≈ô√≠≈æky */
    }

    .daterangepicker td.in-range.available.weekend {}

    .daterangepicker td.in-range.available.holiday {}


    /* Odstranƒõn√≠ stylu pro in-range, aby se neobarvoval cel√Ω interval */
    .daterangepicker td.in-range {}

    /* skryje blikaj√≠c√≠ kurzor u v≈°ech readonly pol√≠ */
    input[readonly] {
      caret-color: transparent;
    }

    #daterange:focus {
      outline: none;
    }

    .daterangepicker.show-input #daterange {
      caret-color: transparent;
    }

    /* Lehƒç√≠ st√≠n */
    .card {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    /* V√≠ce vertik√°ln√≠ho prostoru */
    .row.gy-4 {
      /* ji≈æ definov√°no Bootstrapem, jen uprav odstupy */
      --bs-gutter-y: 1.5rem;
    }

    /* Akcentn√≠ linka u titulk≈Ø */
    .card-title {
      font-size: 1.25rem;
      border-left: 3px solid var(--primary);
      padding-left: 0.75rem;
      margin-bottom: 1.25rem;
    }

    /* P≈ôechodov√Ω hover efekt v tabulce */
    .recap-table tbody tr:hover {
      background-color: rgba(0, 0, 0, 0.03);
      transition: background-color 0.2s ease;
    }

    /* Accordion m√≠sto collapse */
    .btn-warning {
      background-color: #fd7e14;
      border-color: #fd7e14;
    }

    .daterangepicker td.start-date.active {
      background-color: #0a53be;
    }

    .daterangepicker td.end-date.in-range {
      color: white;
      background-color: #073a87;
    }

    /* Blur‚Äëin effect pro modal dialog */
    .modal.fade .modal-dialog {
      opacity: 0;
      filter: blur(10px);
      transition: opacity 0.5s ease, filter 0.5s ease;
    }

    .modal.fade.show .modal-dialog {
      opacity: 1;
      filter: blur(0);
    }

    /* (Nepovinnƒõ) Blur pozad√≠ str√°nky p≈ôi otev≈ôen√©m modalu */
    body.modal-open .container {
      filter: blur(5px);
      transition: filter 0.3s ease;
    }
  </style>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>

  <div class="container py-4">

    <!-- Formul√°≈ô v√Ωbƒõru -->

    <div class="card shadow-sm">


      <div class="card-body">
        <h5 class="card-title">Kalkul√°tor pobytu</h5>
        <div class="row gy-3">


          <div class="col-md-6">
            <div class="mb-3 d-inline">
              <div class="row">
                <div class="col-md-6 col-sm-6">
                  <label class="form-label">Datum p≈ô√≠jezdu - Datum odjezdu</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="material-icons">calendar_month</i></span>
                    <input type="text" id="daterange" class="form-control" readonly>
                  </div>
                </div>
                <div class="col-md-6 col-sm-6">
                  <label class="form-label"><span class="ms-2" id="capacityDisplay">11+5</span>
                  </label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="material-icons">apartment</i></span>
                    <select id="apartmentSelect" class="form-select">
                      <option value="A">Apartm√°n A</option>
                      <option value="B">Apartm√°n B</option>
                      <option value="AB">Cel√Ω objekt</option>
                    </select>
                  </div>
                </div>


              </div>
              <!-- P≈Øvodn√≠ radio blok nahraƒète t√≠mto -->
              <div class="mb-3 mt-3">

              </div>
            </div>

          </div>
          <div class="col-md-6">
            <div class="row  ">
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dospƒõl√≠ch</label>

                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">people</i></span>
                  <select id="adultCount" class="form-select"></select>
                </div>

              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dƒõt√≠</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">child_care</i></span>
                  <select id="childCount" class="form-select"></select>

                </div>

              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dƒõt√≠ (do 3 let)</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">child_friendly</i></span>
                  <select id="toddlerCount" class="form-select">
                    <!-- mo≈ænosti se budou plnit JS -->
                  </select>
                </div>
              </div>

              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Mazl√≠ƒçci</label>

                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">pets</i></span>

                  <select id="petsCount" class="form-select">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>

                  </select>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <!-- Rekapitulace -->
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">

            <h5 class="card-title">Cenov√° nab√≠dka</h5>
            <div class="accordion" id="priceAccordion">
              <div class="accordion-item " id="silvesterNotice">
                <h2 class="accordion-header" id="headingSyl">
                  <button class="accordion-button collapsed sylwester" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseSyl" aria-expanded="false" aria-controls="collapseSyl">
                    üéâ Silvestrovsk√Ω tarif ‚Äì v√≠ce info
                  </button>
                </h2>
                <div id="collapseSyl" class="accordion-collapse collapse" aria-labelledby="headingSyl"
                  data-bs-parent="#priceAccordion">
                  <div class="accordion-body">
                    <strong>Minim√°ln√≠ d√©lka pobytu</strong>
                    4 noci <br>

                    <strong>Apartm√°n A</strong>
                    7 000 CZK/noc<br>
                    a≈æ 10 osob <br>
                    ka≈æd√° dal≈°√≠ osoba +700 CZK/noc

                    <strong>Apartm√°n B</strong>
                    4 200 CZK/noc<br>
                    a≈æ 6 osob<br>
                    ka≈æd√° dal≈°√≠ osoba +700 CZK/noc
                  </div>
                </div>
              </div>
            </div>



            <table class="table recap-table">
              <tbody>

                <tr>
                  <th scope="row">Datum p≈ô√≠jezdu - Datum odjezdu</th>
                  <td class="text-start" id="sumTerm">‚Äì</td>
                </tr>
                <tr>

                  <th scope="row">Poƒçet noc√≠</th>
                  <td class="text-start" id="sumNights">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row">Apartm√°n</th>
                  <td class="text-start" id="sumApartment">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dospƒõl√≠ch</th>
                  <td class="text-start" id="sumAdults">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dƒõt√≠</th>
                  <td class="text-start" id="sumChildren">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dƒõt√≠ (do 3 let)</th>
                  <td class="text-start" id="sumToddlers">‚Äì</td>
                </tr>

                <tr>
                  <th scope="row">Mazl√≠ƒçci</th>
                  <td class="text-start" id="sumPets">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row">Cena pobytu </th>
                  <td class="text-start" id="totalPrice">0 CZK</td>
                </tr>
              </tbody>
            </table>

          </div>

          <!-- Rekapitulace -->
         
        </div>


      </div>
       <div class="col-md-6">

            <!-- Nov√° karta pro z√°jemce -->
            <div class="card shadow-sm ">
              <div class="card-body">
                <h5 class="card-title">M√°te o tento pobyt z√°jem?</h5>
                <div class="row gy-3">
                  <div class="col-md-9 col-sm-12 mb-3">
                    <div class="input-group">
                      <span class="input-group-text"><i class="material-icons">email</i></span>
                      <input type="email" id="userEmail" class="form-control" placeholder="nap≈ô. jana@priklad.cz"
                        required>
                    </div>
                  </div>
                </div>
                <button id="interestButton" class="btn btn-primary">Odeslat</button>
              </div>
            </div>
          </div>
    </div>

  </div>

  <!-- Skripty -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
  <!-- Skripty -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
  <script>
    $(function () {
      const holidays = ['01-01', '05-08', '07-05', '07-06', '09-28', '10-28', '11-17', '04-04', '04-05', '05-01'];

      // --- Ukl√°d√°n√≠ / naƒç√≠t√°n√≠ stavu ---
      function saveState() {
        const state = {
          term: $('#daterange').val(),
          apartment: $('#apartmentSelect').val(),
          adults: $('#adultCount').val(),
          children: $('#childCount').val(),
          toddlers: $('#toddlerCount').val(),
          pets: $('#petsCount').val()
        };
        localStorage.setItem('bookingState', JSON.stringify(state));
      }

      function loadState() {
        const raw = localStorage.getItem('bookingState');
        if (!raw) return;
        const state = JSON.parse(raw);

        const picker = $('#daterange').data('daterangepicker');
        const [from, to] = state.term.split(' - ');
        picker.setStartDate(from);
        picker.setEndDate(to);
        $('#daterange').val(state.term);

        $('#apartmentSelect').val(state.apartment).trigger('change');
        $('#adultCount').val(state.adults);
        $('#childCount').val(state.children);
        $('#toddlerCount').val(state.toddlers);
        $('#petsCount').val(state.pets);

        recalc();
      }

      // --- Inicializace datepickeru ---
      $('#daterange').daterangepicker({
        locale: {
          format: 'DD.MM.YYYY',
          separator: ' - ',
          daysOfWeek: ['Ne', 'Po', '√öt', 'St', 'ƒåt', 'P√°', 'So'],
          monthNames: ['Leden', '√önor', 'B≈ôezen', 'Duben', 'Kvƒõten', 'ƒåerven', 'ƒåervenec', 'Srpen', 'Z√°≈ô√≠', '≈ò√≠jen', 'Listopad', 'Prosinec'],
          firstDay: 1,
          applyLabel: 'Aplikovat',
          cancelLabel: 'Zru≈°it'
        },
        startDate: moment().add(1, 'days'),
        endDate: moment().add(3, 'days'),
        isCustomDate: date => {
          const wd = date.day();
          if (wd === 5 || wd === 6) return 'weekend';
          if (holidays.includes(date.format('MM-DD'))) return 'holiday';
          return '';
        }
      });

      // Aktivn√≠ label
      $('label[for="daterange"]').addClass('active');
      $('#daterange').on('apply.daterangepicker', () => {
        $('label[for="daterange"]').addClass('active');
      });

      // Tooltip pro sv√°tky
      $('#daterange').on('show.daterangepicker', (ev, picker) => {
        setTimeout(() => {
          picker.container.find('td.available.holiday')
            .attr('title', 'Sv√°tek')
            .tooltip({ placement: 'top' });
        }, 0);
      });

      // --- P≈ôepoƒçet ceny a rekapitulace ---
      function recalc() {
        $('#adultCount, #childCount, #toddlerCount').prop('disabled', false);

        const apt = $('#apartmentSelect').val();
        const adults = +$('#adultCount').val();
        const children = +$('#childCount').val();
        const toddlers = +$('#toddlerCount').val();
        const pets = +$('#petsCount').val();

        const term = $('#daterange').val();
        const [from, to] = term.split(' - ');
        const start = moment(from, 'DD.MM.YYYY');
        const end = moment(to, 'DD.MM.YYYY');
        const nights = end.diff(start, 'days');

        const dec31This = moment({ year: start.year(), month: 11, day: 31 });
        const dec31Next = moment({ year: start.year() + 1, month: 11, day: 31 });
        const sylwester = (start.isSameOrBefore(dec31This) && end.isAfter(dec31This))
          || (start.isSameOrBefore(dec31Next) && end.isAfter(dec31Next));

        let total = 0;

        if (sylwester) {
          // Silvestrovsk√Ω tarif
          if (nights < 4) {
            alert('Minim√°ln√≠ d√©lka pobytu pro Silvestr je 4 noci. Spoƒç√≠t√°no bude 4 noci.');
          }
          const chargeN = Math.max(nights, 4);

          // z√°kladn√≠ sazba a poƒçet zahrnut√Ωch osob
          let baseRate, included;
          if (apt === 'A') { baseRate = 7000; included = 10; }
          else if (apt === 'B') { baseRate = 4200; included = 6; }
          else { baseRate = 7000 + 4200; included = 16; }

          // spoƒç√≠tat skuteƒçn√Ω poƒçet host≈Ø (dospƒõl√≠ + dƒõti od 3 + dƒõti do 3)
          const guests = adults + children + toddlers;
          const extraGuests = Math.max(0, guests - included);
          const extraCharge = extraGuests * 700 * chargeN;

          // vynutit minim√°ln√≠ poƒçet osob a zafixovat selects
          $('#adultCount').val(Math.max(adults, included));

          // aktualizovat rekapitulaci host≈Ø
          $('#sumAdults').text(Math.max(adults, included));
          $('#sumChildren').text(0);
          $('#sumToddlers').text(0);
          // pokud chcete, m≈Ø≈æete zobrazit extra osoby zvl√°≈°≈•:
          // $('#sumExtra').text(extraGuests);

          // skr√Ωt nulov√© ≈ô√°dky
          $('#sumChildren').closest('tr').toggle(false);
          $('#sumToddlers').closest('tr').toggle(false);
          $('#sumPets').closest('tr').toggle(pets > 0);

          // koneƒçn√° cena = tarif * noci + p≈ô√≠platek za nav√≠c
          total = chargeN * baseRate + extraCharge;
        } else {
          // Bƒõ≈æn√° cenov√° logika
          const cap = (apt === 'A' ? 11 : apt === 'B' ? 6 : 17);
          const emptyBeds = cap - (adults + children);
          for (let d = start.clone(); d.isBefore(end); d.add(1, 'days')) {
            const mm = d.format('MM-DD'), wd = d.day();
            const rate = ([5, 6].includes(wd) || holidays.includes(mm)) ? 650 : 550;
            total += rate * (adults + children)
              + pets * 300
              + emptyBeds * 300;
          }
          // 30% p≈ô√≠platek za jednu noc
          if (nights === 1) {
            total = Math.round(total * 1.3);
          }
        }

        // Aktualizace UI
        $('#silvesterNotice').toggle(sylwester);
        $('#sumTerm').text(term);
        $('#sumNights').text(nights);
        $('#sumApartment').text(
          apt === 'A' ? 'Apartm√°n A' :
            apt === 'B' ? 'Apartm√°n B' :
              'Cel√Ω objekt'
        );
        $('#sumAdults').text(adults);
        $('#sumChildren').text(children);
        $('#sumToddlers').text(toddlers);
        $('#sumPets').text(pets);

        $('#sumChildren').closest('tr').toggle(children > 0);
        $('#sumToddlers').closest('tr').toggle(toddlers > 0);
        $('#sumPets').closest('tr').toggle(pets > 0);

        $('#totalPrice').text(total.toLocaleString() + ' CZK');
        $('.col-lg-5').toggle((adults + children) > 0);

        saveState();
      }

      // --- Naplnƒõn√≠ select≈Ø podle kapacity ---
      function updateCounts() {
        const apt = $('#apartmentSelect').val();
        const base = (apt === 'A' ? 11 : apt === 'B' ? 6 : 17);
        const extra = (apt === 'A' ? 5 : apt === 'B' ? 2 : 7);
        const max = base + extra;

        $('#capacityDisplay').text(`Kapacita osob: ${max} (${base} + ${extra})`);

        const prevA = +$('#adultCount').val() || 1;
        $('#adultCount').empty();
        for (let i = 1; i <= max; i++) $('#adultCount').append(new Option(i, i));
        $('#adultCount').val(Math.min(prevA, max));

        const prevC = +$('#childCount').val() || 0;
        $('#childCount').empty();
        for (let i = 0; i <= max; i++) $('#childCount').append(new Option(i, i));
        $('#childCount').val(Math.min(prevC, max - $('#adultCount').val()));

        const prevT = +$('#toddlerCount').val() || 0;
        $('#toddlerCount').empty();
        for (let i = 0; i <= 10; i++) $('#toddlerCount').append(new Option(i, i));
        $('#toddlerCount').val(Math.min(prevT, 10));

        // Vz√°jemn√© omezen√≠ dospƒõl√≠/dƒõti
        $('#adultCount, #childCount').off('change').on('change', function () {
          const a = +$('#adultCount').val(), c = +$('#childCount').val();
          const left = max - (this.id === 'adultCount' ? a : c);
          const other = this.id === 'adultCount' ? '#childCount' : '#adultCount';
          const prev = +$(other).val() || 0;
          $(other).empty();
          for (let i = 0; i <= left; i++) $(other).append(new Option(i, i));
          $(other).val(Math.min(prev, left));
          recalc();
        });

        $('#toddlerCount, #petsCount').off('change').on('change', recalc);
        $('#daterange').off('apply.daterangepicker').on('apply.daterangepicker', recalc);

        recalc();
      }

      // --- Spu≈°tƒõn√≠ ---
      $('#apartmentSelect').on('change', updateCounts);
      loadState();

      updateCounts();
    });
    // Odesl√°n√≠ e‚Äëmailu na krystoma@seznam.cz
    $('#interestButton').on('click', function () {
      const email = $('#userEmail').val().trim();
      const term = $('#sumTerm').text();
      const apartment = $('#sumApartment').text();

      // Jednoduch√° validace
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        return alert('Pros√≠m vlo≈æte platnou e‚Äëmailovou adresu.');
      }

      // P≈ôedmƒõt a tƒõlo
      const subject = encodeURIComponent(`Z√°jem o rezervaci ${term} ‚Äì ${apartment}`);
      const body = encodeURIComponent(
        `Dobr√Ω den,\n\nm√°m z√°jem o term√≠n ${term} (${apartment}).\nM≈Øj e‚Äëmail je: ${email}\n\nDƒõkuji a tƒõ≈°√≠m se na odpovƒõƒè.`
      );

      // Otev≈ôe v√Ωchoz√≠ mail klient
      window.location.href = `mailto:krystoma@seznam.cz?subject=${subject}&body=${body}`;
    });

  </script>
  <!-- Exit‚Äëintent Modal -->
  <div class="modal fade" id="exitModal" tabindex="-1" aria-labelledby="exitModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exitModalLabel">Je≈°tƒõ chv√≠li!</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zav≈ô√≠t"></button>
        </div>
        <div class="modal-body">
          <p>Ne≈æ odejdete, pros√≠m sdƒõlte n√°m, proƒç opou≈°t√≠te str√°nku:</p>
          <div class="mb-3">
            <textarea id="exitReason" class="form-control" rows="3" placeholder="D≈Øvod..."></textarea>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="wantOffer">
            <label class="form-check-label" for="wantOffer">
              Mƒõl(a) bych z√°jem o lep≈°√≠ cenovou nab√≠dku
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ne, dƒõkuji</button>
          <button type="button" id="submitExitInfo" class="btn btn-primary">Odeslat</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    (function () {
      let exitModalShown = false;
      const modalEl = document.getElementById('exitModal');
      const bsModal = new bootstrap.Modal(modalEl);
      const SHOW_DELAY = 700; //‚Ääzpo≈ædƒõn√≠ v ms

      function sendExitInfo() {
        const reason = document.getElementById('exitReason').value.trim();
        const wantOffer = document.getElementById('wantOffer').checked;
        console.log('Exit reason:', reason, 'Chci nab√≠dku:', wantOffer);
        bsModal.hide();
      }
      document.getElementById('submitExitInfo')
        .addEventListener('click', sendExitInfo);

      function showWithDelay() {
        exitModalShown = true;
        setTimeout(() => bsModal.show(), SHOW_DELAY);
      }

      document.addEventListener('mouseout', function (e) {
        if (e.clientY < 5 && !exitModalShown) {
          showWithDelay();
        }
      });

      window.addEventListener('beforeunload', function (e) {
        if (!exitModalShown) {
          e.preventDefault();
          e.returnValue = '';
          showWithDelay();
          return '';
        }
      });
    })();

  </script>

</body>

</html>