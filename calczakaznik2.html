<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulace ubytov√°n√≠</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Barvy a typografie */
    :root {
      --primary: #0d6efd;
      --muted: #adb5bd;
      --text: #212529;
    }

    body {
      background: #e9ecef;
      color: var(--text);
      font-family: 'Roboto', sans-serif;
    }

    h1,
    .card-title {
      font-weight: 600;
      color: var(--text);
    }

    /* Karty a formul√°≈ô */
    .card {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: .5rem;
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: #495057;
    }

    .form-label i {
      margin-right: .5rem;
    }

    .form-check-input {
      accent-color: var(--primary);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 .25rem rgba(133, 67, 3, 0.25);
    }

    .text-muted {
      color: #6c757d !important;
    }

    /* Rekapitulace */
    .recap-table th,
    .recap-table td.in-range {
      border-top: none;
      color: var(--text);
    }

    .recap-table th {
      font-weight: 500;
      color: #343a40;
    }

    #totalPrice {
      color: #dc3545;
      font-weight: 600;
    }

    /* Datepicker */
    .daterangepicker td.off {
      visibility: hidden;
      /* Skryt√≠ obsahu, zachov√° strukturu m≈ô√≠≈æky */
    }

    .daterangepicker td.in-range.available.weekend {}

    .daterangepicker td.in-range.available.holiday {}

    /* Pouze vybran√© dny (prvn√≠ a posledn√≠) */
    .daterangepicker td.available.active {
      background-color: var(--primary) !important;
      border-color: var(--primary) !important;
      color: #fff !important;
    }

    /* Odstranƒõn√≠ stylu pro in-range, aby se neobarvoval cel√Ω interval */
    .daterangepicker td.in-range {
      background: #1a1a1a0f !important;
      color: var(--text) !important;
    }
  </style>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>

  <div class="container py-4">
    <div class="row gy-3">
      <!-- Formul√°≈ô v√Ωbƒõru -->
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body">

            <div class="mb-3 d-inline">
              <div class="row">
                <div class="col-md-6 col-sm-6">
                  <label class="form-label">Datum p≈ô√≠jezdu - Datum odjezdu</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="material-icons">calendar_month</i></span>
                    <input type="text" id="daterange" class="form-control" readonly>
                  </div>
                </div>
                <div class="col-md-6 col-sm-6">
                  <label class="form-label"><span class="ms-2" id="capacityDisplay">11+5</span>
                  </label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="material-icons">apartment</i></span>
                    <select id="apartmentSelect" class="form-select">
                      <option value="A">Apartm√°n A</option>
                      <option value="B">Apartm√°n B</option>
                      <option value="AB">Cel√Ω objekt</option>
                    </select>
                  </div>
                </div>


              </div>
              <!-- P≈Øvodn√≠ radio blok nahraƒète t√≠mto -->
              <div class="mb-3 mt-3">

              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dospƒõl√≠</label>

                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">people</i></span>
                  <select id="adultCount" class="form-select"></select>
                </div>

              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dƒõti od 3 let</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">child_care</i></span>
                  <select id="childCount" class="form-select"></select>

                </div>

              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dƒõti do 2,99 let</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">child_friendly</i></span>
                  <select id="toddlerCount" class="form-select">
                    <!-- mo≈ænosti se budou plnit JS -->
                  </select>
                </div>
              </div>

              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Mazl√≠ƒçci</label>

                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">pets</i></span>

                  <select id="petsCount" class="form-select">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>

                  </select>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Rekapitulace -->
      <div class="col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Cenov√° nab√≠dka</h5>
            <p id="silvesterNotice">
              <a class="btn btn-warning" data-bs-toggle="collapse" href="#silvesterDetails2" role="button"
                aria-expanded="true" aria-controls="silvesterDetails2">
                üéâ Silvestrovsk√Ω tarif ‚Äì v√≠ce info
              </a>
            </p>
            <div class="collapse" id="silvesterDetails2">
              <div class="card card-body">
                <strong>Minim√°ln√≠ d√©lka pobytu</strong>
                <em>4 noci</em><br>

                <strong>Apartm√°n A</strong>
                <em>7 000 CZK/noc</em>10 osob<br>
                <em>ka≈æd√° dal≈°√≠ osoba +700 CZK/noc</em><br>

                <strong>Apartm√°n B</strong>
                <em>4 200 CZK/noc</em>6 osob<br>
                <em>ka≈æd√° dal≈°√≠ osoba +700 CZK/noc</em>
              </div>
            </div>

            <table class="table recap-table">
              <tbody>

                <tr>
                  <th scope="row">Datum p≈ô√≠jezdu - Datum odjezdu</th>
                  <td class="text-end" id="sumTerm">‚Äì</td>
                </tr>
                <tr>

                  <th scope="row">Noc√≠</th>
                  <td class="text-end" id="sumNights">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row">Apartm√°n</th>
                  <td class="text-end" id="sumApartment">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dospƒõl√≠</th>
                  <td class="text-end" id="sumAdults">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dƒõti od 3 let</th>
                  <td class="text-end" id="sumChildren">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dƒõti do 2,99 let</th>
                  <td class="text-end" id="sumToddlers">‚Äì</td>
                </tr>

                <tr>
                  <th scope="row">Mazl√≠ƒçci</th>
                  <td class="text-end" id="sumPets">‚Äì</td>
                </tr>
              </tbody>
            </table>
            <h4 class="text-end">Cena pobytu: <span id="totalPrice">0 CZK</span></h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Skripty -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
  <script>
    $(function () {
      const holidays = ['01-01', '05-08', '07-05', '07-06', '09-28', '10-28', '11-17', '04-04', '04-05', '05-01'];

      // Daterangepicker
      $('#daterange').daterangepicker({
        locale: {
          format: 'DD.MM.YYYY', separator: ' - ',
          daysOfWeek: ['Ne', 'Po', '√öt', 'St', 'ƒåt', 'P√°', 'So'],
          monthNames: ['Leden', '√önor', 'B≈ôezen', 'Duben', 'Kvƒõten', 'ƒåerven', 'ƒåervenec', 'Srpen', 'Z√°≈ô√≠', '≈ò√≠jen', 'Listopad', 'Prosinec'],
          firstDay: 1, applyLabel: 'Aplikovat', cancelLabel: 'Zru≈°it'
        },
        startDate: moment().add(1, 'days'),
        endDate: moment().add(3, 'days'),
        isCustomDate: function (date) {
          const wd = date.day();
          // pouze p√°tek (5) a sobota (6)
          if (wd === 6 || wd === 7) return 'weekend';
          if (holidays.includes(date.format('MM-DD'))) return 'holiday';
          return '';
        }
      });

      // Aktivn√≠ label
      $('label[for="daterange"]').addClass('active');
      $('#daterange').on('apply.daterangepicker', function () {
        $('label[for="daterange"]').addClass('active');
      });

      // Tooltip pro sv√°tky
      $('#daterange').on('show.daterangepicker', (ev, picker) => {
        setTimeout(() => {
          picker.container.find('td.available.holiday').each(function () {
            const rec = holidays.find(h => h.date === moment($(this).data('title'), 'YYYY-MM-DD').format('MM-DD'));
            if (rec) $(this).attr('title', rec.title).tooltip({ placement: 'top' });
          });
        }, 0);
      });

      // Bind events
      $('#apartmentSelect').on('change', updateCounts);
      $('#adultCount, #childCount, #petsCount').on('change', recalc);
      $('#daterange').on('apply.daterangepicker', recalc);

      // Naplnƒõn√≠ poƒçt≈Ø a omezen√≠ podle kapacity
      function updateCounts() {
        const apt = $('#apartmentSelect').val();
        let cap = apt === 'A' ? 11 : apt === 'B' ? 6 : 18;
        let extra = apt === 'A' ? 5 : apt === 'B' ? 2 : 8;
        const totalCap = cap + extra;

        // m√≠sto "11+5" teƒè "Kapacita osob: 16 (11 postel√≠ a 5 p≈ôist√Ωlek)"
        $('#capacityDisplay').text(
          `Kapacita osob: ${totalCap} (${cap} + ${extra})`
        );
        const maxTotal = cap + extra;

        // Dospƒõl√≠
        const prevAdults = +$('#adultCount').val() || 1;
        $('#adultCount').empty();
        for (let i = 1; i <= maxTotal; i++) $('#adultCount').append(new Option(i, i));
        $('#adultCount').val(Math.min(prevAdults, maxTotal));

        // Dƒõti
        const prevChildren = +$('#childCount').val() || 0;
        $('#childCount').empty();
        for (let i = 0; i <= maxTotal; i++) $('#childCount').append(new Option(i, i));
        $('#childCount').val(Math.min(prevChildren, maxTotal - $('#adultCount').val()));
        // Dƒõti do 2,99 let ‚Äì max. 10
        const prevToddlers = +$('#toddlerCount').val() || 0;
        $('#toddlerCount').empty();
        for (let i = 0; i <= 10; i++) {
          $('#toddlerCount').append(new Option(i, i));
        }
        $('#toddlerCount').val(Math.min(prevToddlers, 10));
        $('#toddlerCount').off('change').on('change', recalc);

        // P≈ôi zmƒõnƒõ uprav kapacity druh√©
        $('#adultCount').off('change').on('change', function () {
          const adults = +this.value;
          const childMax = maxTotal - adults;
          const prevChild = +$('#childCount').val() || 0;
          $('#childCount').empty();
          for (let i = 0; i <= childMax; i++) $('#childCount').append(new Option(i, i));
          $('#childCount').val(Math.min(prevChild, childMax));
          recalc();
        });
        $('#childCount').off('change').on('change', function () {
          const children = +this.value;
          const adultMax = maxTotal - children;
          const prevAdult = +$('#adultCount').val() || 0;
          $('#adultCount').empty();
          for (let i = 0; i <= adultMax; i++) $('#adultCount').append(new Option(i, i));
          $('#adultCount').val(Math.min(prevAdult, adultMax));
          recalc();
        });

        recalc();
      } function recalc() {
        // 0) Pro bƒõ≈æn√© term√≠ny odblokuj poƒçet host≈Ø
        $('#adultCount, #childCount, #toddlerCount').prop('disabled', false);

        const apt = $('#apartmentSelect').val();           // 'A', 'B' nebo 'AB'
        const adults = +$('#adultCount').val();
        const children = +$('#childCount').val();
        const toddlers = +$('#toddlerCount').val();
        const pets = +$('#petsCount').val();

        const term = $('#daterange').val();
        const start = moment(term.split(' - ')[0], 'DD.MM.YYYY');
        const end = moment(term.split(' - ')[1], 'DD.MM.YYYY');
        const nights = end.diff(start, 'days');

        // 1) Korektn√≠ detekce Silvestra (31.12.)
        const dec31ThisYear = moment({ year: start.year(), month: 11, day: 31 });
        const dec31NextYear = moment({ year: start.year() + 1, month: 11, day: 31 });
        const includesSilvester =
          (start.isSameOrBefore(dec31ThisYear) && end.isAfter(dec31ThisYear)) ||
          (start.isSameOrBefore(dec31NextYear) && end.isAfter(dec31NextYear));

        let total = 0;

        if (includesSilvester) {
          // --- Silvestrovsk√° logika ---
          // 2) minim√°ln√≠ d√©lka pobytu 4 noci
          if (nights < 4) {
            alert('Minim√°ln√≠ d√©lka pobytu pro Silvestr je 4 noci. Cena bude spoƒç√≠t√°na pro 4 noci.');
          }
          const chargeNights = Math.max(nights, 4);

          // 3) tarif a minim√°ln√≠ poƒçet osob podle apartm√°nu
          let baseRate, includedPeople;
          if (apt === 'A') {
            baseRate = 7000;
            includedPeople = 10;
          } else if (apt === 'B') {
            baseRate = 4200;
            includedPeople = 6;
          } else {
            baseRate = 7000 + 4200;
            includedPeople = 10 + 6;
          }

          // 4) vynucen√≠ minim√°ln√≠ho poƒçtu host≈Ø
          const minPeople = includedPeople;
          $('#adultCount').val(minPeople);
          $('#childCount').val(0);
          $('#toddlerCount').val(0);
          $('#adultCount, #childCount, #toddlerCount').prop('disabled', true);

          // 5) p≈ô√≠platek za hosty nad limit
          const extraPeople = Math.max(0, minPeople - includedPeople);
          const extraCharge = extraPeople * 700;

          total = chargeNights * (baseRate + extraCharge);

        } else {
          // --- bƒõ≈æn√° cenov√° logika ---
          const cap = apt === 'A' ? 11 : apt === 'B' ? 6 : 17;
          const emptyBeds = cap - (adults + children);

          for (let d = start.clone(); d.isBefore(end); d.add(1, 'days')) {
            const m = d.format('MM-DD'),
              wd = d.day(),
              rate = ([5, 6].includes(wd) || holidays.includes(m)) ? 650 : 550;
            total += rate * (adults + children + toddlers)
              + pets * 300
              + emptyBeds * 300;
          }

          // 30% p≈ô√≠platek za jednu noc
          if (nights === 1) {
            total = Math.round(total * 1.3);
          }
        }

        // 6) Uka≈æ / skryj upozornƒõn√≠ o Silvestru
        $('#silvesterNotice').toggle(includesSilvester);

        // 7) Aktualizace rekapitulace
        $('#sumTerm').text(term);
        $('#sumNights').text(nights);
        $('#sumApartment').text(
          apt === 'A' ? 'Apartm√°n A' :
            apt === 'B' ? 'Apartm√°n B' :
              'Cel√Ω objekt'
        );
        $('#sumAdults').text($('#adultCount').val());
        $('#sumChildren').text($('#childCount').val());
        $('#sumToddlers').text($('#toddlerCount').val());
        $('#sumPets').text(pets);
        // 8) Skryj ≈ô√°dky, kde je hodnota 0
        $('#sumChildren').closest('tr').toggle(children > 0);
        $('#sumToddlers').closest('tr').toggle(toddlers > 0);
        $('#sumPets').closest('tr').toggle(pets > 0);

        $('#totalPrice').text(total.toLocaleString() + ' CZK');

        // 8) Skr√Ωt rekapitulaci, kdy≈æ nejsou host√©
        $('.col-lg-5').toggle((+$('#adultCount').val() + +$('#childCount').val() + +$('#toddlerCount').val()) > 0);
      }



      // Spu≈°tƒõn√≠ inicializace
      updateCounts();
    });
  </script>
</body>

</html>