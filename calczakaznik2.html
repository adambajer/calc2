<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulace ubytov√°n√≠</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Barvy a typografie */
    :root {
      --primary: #0d6efd;
      --muted: #adb5bd;
      --text: #212529;
    }

    body {
      background: #e9ecef;
      color: var(--text);
      font-family: 'Roboto', sans-serif;
    }

    h1,
    .card-title {
      font-weight: 600;
      color: var(--text);
    }

    /* Karty a formul√°≈ô */
    .card {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: .5rem;
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: #495057;
    }

    .form-label i {
      margin-right: .5rem;
    }

    .form-check-input {
      accent-color: var(--primary);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 .25rem rgba(133, 67, 3, 0.25);
    }

    .text-muted {
      color: #6c757d !important;
    }

    /* Rekapitulace */
    .recap-table th,
    .recap-table td.in-range {
      border-top: none;
      color: var(--text);
    }

    .recap-table th {
      font-weight: 500;
      color: #343a40;
    }

    #totalPrice {
      color: #dc3545;
      font-weight: 600;
    }

    /* Datepicker */
    .daterangepicker td.off {
      visibility: hidden;
      /* Skryt√≠ obsahu, zachov√° strukturu m≈ô√≠≈æky */
    }

    .daterangepicker td.in-range.available.weekend {}

    .daterangepicker td.in-range.available.holiday {}

    /* Pouze vybran√© dny (prvn√≠ a posledn√≠) */
    .daterangepicker td.available.active {
      background-color: var(--primary) !important;
      border-color: var(--primary) !important;
      color: #fff !important;
    }

    /* Odstranƒõn√≠ stylu pro in-range, aby se neobarvoval cel√Ω interval */
    .daterangepicker td.in-range {
      background: #1a1a1a0f !important;
      color: var(--text) !important;
    }/* skryje blikaj√≠c√≠ kurzor u v≈°ech readonly pol√≠ */
input[readonly] {
  caret-color: transparent;
}
#daterange:focus { outline: none; }
.daterangepicker.show-input #daterange {
  caret-color: transparent;
}

  </style>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>

  <div class="container py-4">
    <div class="row gy-3">
      <!-- Formul√°≈ô v√Ωbƒõru -->
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body">

            <div class="mb-3 d-inline">
              <div class="row">
                <div class="col-md-6 col-sm-6">
                  <label class="form-label">Datum p≈ô√≠jezdu - Datum odjezdu</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="material-icons">calendar_month</i></span>
                    <input type="text" id="daterange" class="form-control" readonly>
                  </div>
                </div>
                <div class="col-md-6 col-sm-6">
                  <label class="form-label"><span class="ms-2" id="capacityDisplay">11+5</span>
                  </label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="material-icons">apartment</i></span>
                    <select id="apartmentSelect" class="form-select">
                      <option value="A">Apartm√°n A</option>
                      <option value="B">Apartm√°n B</option>
                      <option value="AB">Cel√Ω objekt</option>
                    </select>
                  </div>
                </div>


              </div>
              <!-- P≈Øvodn√≠ radio blok nahraƒète t√≠mto -->
              <div class="mb-3 mt-3">

              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dospƒõl√≠</label>

                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">people</i></span>
                  <select id="adultCount" class="form-select"></select>
                </div>

              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dƒõti od 3 let</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">child_care</i></span>
                  <select id="childCount" class="form-select"></select>

                </div>

              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Dƒõti do 2,99 let</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">child_friendly</i></span>
                  <select id="toddlerCount" class="form-select">
                    <!-- mo≈ænosti se budou plnit JS -->
                  </select>
                </div>
              </div>

              <div class="col-md-3 col-sm-6 mb-3">
                <label class="form-label">Mazl√≠ƒçci</label>

                <div class="input-group">
                  <span class="input-group-text"><i class="material-icons">pets</i></span>

                  <select id="petsCount" class="form-select">
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>

                  </select>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Rekapitulace -->
      <div class="col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Cenov√° nab√≠dka</h5>
            <p id="silvesterNotice">
              <a class="btn btn-warning" data-bs-toggle="collapse" href="#silvesterDetails2" role="button"
                aria-expanded="true" aria-controls="silvesterDetails2">
                üéâ Silvestrovsk√Ω tarif ‚Äì v√≠ce info
              </a>
            </p>
            <div class="collapse" id="silvesterDetails2">
              <div class="card card-body">
                <strong>Minim√°ln√≠ d√©lka pobytu</strong>
                <em>4 noci</em><br>

                <strong>Apartm√°n A</strong>
                <em>7 000 CZK/noc</em>10 osob<br>
                <em>ka≈æd√° dal≈°√≠ osoba +700 CZK/noc</em><br>

                <strong>Apartm√°n B</strong>
                <em>4 200 CZK/noc</em>6 osob<br>
                <em>ka≈æd√° dal≈°√≠ osoba +700 CZK/noc</em>
              </div>
            </div>

            <table class="table recap-table">
              <tbody>

                <tr>
                  <th scope="row">Datum p≈ô√≠jezdu - Datum odjezdu</th>
                  <td class="text-start" id="sumTerm">‚Äì</td>
                </tr>
                <tr>

                  <th scope="row">Noc√≠</th>
                  <td class="text-start" id="sumNights">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row">Apartm√°n</th>
                  <td class="text-start" id="sumApartment">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dospƒõl√≠</th>
                  <td class="text-start" id="sumAdults">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dƒõti od 3 let</th>
                  <td class="text-start" id="sumChildren">‚Äì</td>
                </tr>
                <tr>
                  <th scope="row" class="">Dƒõti do 2,99 let</th>
                  <td class="text-start" id="sumToddlers">‚Äì</td>
                </tr>

                <tr>
                  <th scope="row">Mazl√≠ƒçci</th>
                  <td class="text-start" id="sumPets">‚Äì</td>
                </tr>
                 <tr>
                  <th scope="row">Cena pobytu </th>
                  <td class="text-start" id="totalPrice">0 CZK</td>
                </tr>
              </tbody>
            </table>
           </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Skripty -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
 <!-- Skripty -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
<script>
  $(function () {
    const holidays = ['01-01','05-08','07-05','07-06','09-28','10-28','11-17','04-04','04-05','05-01'];

    // --- Ukl√°d√°n√≠ / naƒç√≠t√°n√≠ stavu ---
    function saveState() {
      const state = {
        term:      $('#daterange').val(),
        apartment: $('#apartmentSelect').val(),
        adults:    $('#adultCount').val(),
        children:  $('#childCount').val(),
        toddlers:  $('#toddlerCount').val(),
        pets:      $('#petsCount').val()
      };
      localStorage.setItem('bookingState', JSON.stringify(state));
    }

    function loadState() {
      const raw = localStorage.getItem('bookingState');
      if (!raw) return;
      const state = JSON.parse(raw);

      const picker = $('#daterange').data('daterangepicker');
      const [from, to] = state.term.split(' - ');
      picker.setStartDate(from);
      picker.setEndDate(to);
      $('#daterange').val(state.term);

      $('#apartmentSelect').val(state.apartment).trigger('change');
      $('#adultCount').val(state.adults);
      $('#childCount').val(state.children);
      $('#toddlerCount').val(state.toddlers);
      $('#petsCount').val(state.pets);

      recalc();
    }

    // --- Inicializace datepickeru ---
    $('#daterange').daterangepicker({
      locale: {
        format: 'DD.MM.YYYY',
        separator: ' - ',
        daysOfWeek: ['Ne','Po','√öt','St','ƒåt','P√°','So'],
        monthNames: ['Leden','√önor','B≈ôezen','Duben','Kvƒõten','ƒåerven','ƒåervenec','Srpen','Z√°≈ô√≠','≈ò√≠jen','Listopad','Prosinec'],
        firstDay: 1,
        applyLabel: 'Aplikovat',
        cancelLabel: 'Zru≈°it'
      },
      startDate: moment().add(1,'days'),
      endDate:   moment().add(3,'days'),
      isCustomDate: date => {
        const wd = date.day();
        if (wd === 5 || wd === 6) return 'weekend';
        if (holidays.includes(date.format('MM-DD'))) return 'holiday';
        return '';
      }
    });

    // Aktivn√≠ label
    $('label[for="daterange"]').addClass('active');
    $('#daterange').on('apply.daterangepicker', () => {
      $('label[for="daterange"]').addClass('active');
    });

    // Tooltip pro sv√°tky
    $('#daterange').on('show.daterangepicker', (ev, picker) => {
      setTimeout(() => {
        picker.container.find('td.available.holiday')
          .attr('title', 'Sv√°tek')
          .tooltip({ placement: 'top' });
      }, 0);
    });

    // --- P≈ôepoƒçet ceny a rekapitulace ---
    function recalc() {
      $('#adultCount, #childCount, #toddlerCount').prop('disabled', false);

      const apt      = $('#apartmentSelect').val();
      const adults   = +$('#adultCount').val();
      const children = +$('#childCount').val();
      const toddlers = +$('#toddlerCount').val();
      const pets     = +$('#petsCount').val();

      const term  = $('#daterange').val();
      const [from, to] = term.split(' - ');
      const start = moment(from, 'DD.MM.YYYY');
      const end   = moment(to,   'DD.MM.YYYY');
      const nights = end.diff(start, 'days');

      const dec31This = moment({ year: start.year(),   month: 11, day: 31 });
      const dec31Next = moment({ year: start.year()+1, month: 11, day: 31 });
      const sylwester = (start.isSameOrBefore(dec31This) && end.isAfter(dec31This))
                     || (start.isSameOrBefore(dec31Next) && end.isAfter(dec31Next));

      let total = 0;

      if (sylwester) {
        // Silvestrovsk√Ω tarif
        if (nights < 4) {
          alert('Minim√°ln√≠ d√©lka pobytu pro Silvestr je 4 noci. Spoƒç√≠t√°no bude 4 noci.');
        }
        const chargeN = Math.max(nights, 4);
        let baseRate, included;
        if (apt === 'A')      { baseRate = 7000; included = 10; }
        else if (apt === 'B') { baseRate = 4200; included = 6;  }
        else                  { baseRate = 7000 + 4200; included = 16; }

        $('#adultCount').val(included);
        $('#childCount, #toddlerCount').val(0);
        $('#adultCount, #childCount, #toddlerCount').prop('disabled', true);

        total = chargeN * baseRate;
      } else {
        // Bƒõ≈æn√° cenov√° logika
        const cap       = (apt === 'A' ? 11 : apt === 'B' ? 6 : 17);
        const emptyBeds = cap - (adults + children);
        for (let d = start.clone(); d.isBefore(end); d.add(1, 'days')) {
          const mm = d.format('MM-DD'), wd = d.day();
          const rate = ([5, 6].includes(wd) || holidays.includes(mm)) ? 650 : 550;
          total += rate * (adults + children + toddlers)
                 + pets * 300
                 + emptyBeds * 300;
        }
        // 30% p≈ô√≠platek za jednu noc
        if (nights === 1) {
          total = Math.round(total * 1.3);
        }
      }

      // Aktualizace UI
      $('#silvesterNotice').toggle(sylwester);
      $('#sumTerm').text(term);
      $('#sumNights').text(nights);
      $('#sumApartment').text(
        apt === 'A' ? 'Apartm√°n A' :
        apt === 'B' ? 'Apartm√°n B' :
                       'Cel√Ω objekt'
      );
      $('#sumAdults').text(adults);
      $('#sumChildren').text(children);
      $('#sumToddlers').text(toddlers);
      $('#sumPets').text(pets);

      $('#sumChildren').closest('tr').toggle(children > 0);
      $('#sumToddlers').closest('tr').toggle(toddlers > 0);
      $('#sumPets').closest('tr').toggle(pets > 0);

      $('#totalPrice').text(total.toLocaleString() + ' CZK');
      $('.col-lg-5').toggle((adults + children + toddlers) > 0);

      saveState();
    }

    // --- Naplnƒõn√≠ select≈Ø podle kapacity ---
    function updateCounts() {
      const apt   = $('#apartmentSelect').val();
      const base  = (apt === 'A' ? 11 : apt === 'B' ? 6 : 18);
      const extra = (apt === 'A' ? 5  : apt === 'B' ? 2 : 8);
      const max   = base + extra;

      $('#capacityDisplay').text(`Kapacita osob: ${max} (${base} + ${extra})`);

      const prevA = +$('#adultCount').val() || 1;
      $('#adultCount').empty();
      for (let i = 1; i <= max; i++) $('#adultCount').append(new Option(i, i));
      $('#adultCount').val(Math.min(prevA, max));

      const prevC = +$('#childCount').val() || 0;
      $('#childCount').empty();
      for (let i = 0; i <= max; i++) $('#childCount').append(new Option(i, i));
      $('#childCount').val(Math.min(prevC, max - $('#adultCount').val()));

      const prevT = +$('#toddlerCount').val() || 0;
      $('#toddlerCount').empty();
      for (let i = 0; i <= 10; i++) $('#toddlerCount').append(new Option(i, i));
      $('#toddlerCount').val(Math.min(prevT, 10));

      // Vz√°jemn√© omezen√≠ dospƒõl√≠/dƒõti
      $('#adultCount, #childCount').off('change').on('change', function () {
        const a = +$('#adultCount').val(), c = +$('#childCount').val();
        const left = max - (this.id === 'adultCount' ? a : c);
        const other = this.id === 'adultCount' ? '#childCount' : '#adultCount';
        const prev  = +$(other).val() || 0;
        $(other).empty();
        for (let i = 0; i <= left; i++) $(other).append(new Option(i, i));
        $(other).val(Math.min(prev, left));
        recalc();
      });

      $('#toddlerCount, #petsCount').off('change').on('change', recalc);
      $('#daterange').off('apply.daterangepicker').on('apply.daterangepicker', recalc);

      recalc();
    }

    // --- Spu≈°tƒõn√≠ ---
    $('#apartmentSelect').on('change', updateCounts);
        loadState();

    updateCounts();
  });
</script>

</body>

</html>