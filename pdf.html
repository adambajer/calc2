<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>PDF Generátor - Selský Dvůr</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/@pdf-lib/fontkit/dist/fontkit.umd.js"></script>
</head>
<body>
  <h2>Generuji PDF...</h2>

  <script>
    window.addEventListener("DOMContentLoaded", async function () {
      const fakeData = {
        lastName: "Bajer",
        firstName: "Adam",
        address: "Hnojice 98",
        companyId: "888999",
        email: "adam.bajer@gmail.com",
        phone: "888999000",
        payment: "zálohová faktura +doplatek na místě",
        purpose: "Rekreace",
        orderDate: "2025-06-19",
        men: "0",
        women: "1",
        children: "-",
        dogs: "0",
        note: "-"
      };

      const term = "20.06.2025 - 23.06.2025";
      const apartment = "A";
      const price = "10 750 CZK";

      const formatCzDate = (dateStr) => {
        const [yyyy, mm, dd] = dateStr.split("-");
        return `${dd}.${mm}.${yyyy}`;
      };

      const orderDateCz = formatCzDate(fakeData.orderDate);
      const budova = `Apartmán ${apartment}`;

      const { PDFDocument, rgb, StandardFonts } = PDFLib;
      const pdfDoc = await PDFDocument.create();
      pdfDoc.registerFontkit(window.fontkit);

      // --- ZÁSADNÍ ZMĚNA ZDE: NAČÍTÁNÍ TŘÍ SAMOSTATNÝCH TTF FONTŮ ---
      const ralewayThinBytes = await fetch("Raleway-Thin.ttf").then(res => res.arrayBuffer());
      const ralewayRegularBytes = await fetch("Raleway-Regular.ttf").then(res => res.arrayBuffer()); // Použijeme pro 'normalFont'
      const ralewayBoldBytes = await fetch("Raleway-Bold.ttf").then(res => res.arrayBuffer()); // Použijeme pro 'boldFont'

      const ralewayThin = await pdfDoc.embedFont(ralewayThinBytes);
      const ralewayRegular = await pdfDoc.embedFont(ralewayRegularBytes);
      const ralewayBold = await pdfDoc.embedFont(ralewayBoldBytes);

      const normalFont = ralewayRegular; // Nastavíme Raleway-Regular jako základní font
      const boldFont = ralewayBold;      // Nastavíme Raleway-Bold jako tučný font
      // --- KONEC ZMĚNY ---

      const page = pdfDoc.addPage([595, 842]);
      const fontSize = 10;
      const brownColor = rgb(0.5, 0.2, 0);
      const greyFillColor = rgb(0.95, 0.95, 0.95);

      const marginX = 40;
      const marginY_top = 800;
      const marginY_bottom = 40;

      let y = marginY_top;

      // Logo
      const logoBytes = await fetch("images/black.png").then((r) => r.arrayBuffer());
      const logoImg = await pdfDoc.embedPng(logoBytes);
      const logoWidth = 150;
      const logoHeight = (logoImg.height / logoImg.width) * logoWidth;
      const logoX = (595 - logoWidth) / 2;
      page.drawImage(logoImg, { x: logoX, y: y - logoHeight, width: logoWidth, height: logoHeight });
      y -= logoHeight + 40;

      // Titulek objednávky (používáme normalFont, což je Raleway-Regular)
      const title = "ZÁVAZNÁ OBJEDNÁVKA UBYTOVÁNÍ";
      const titleSize = 22;
      const titleWidth = normalFont.widthOfTextAtSize(title, titleSize);
      const titleX = (595 - titleWidth) / 2;
      page.drawText(title, { x: titleX, y, size: titleSize, font: normalFont });

      y -= 35;

      page.drawText("Číslo objednávky:", { x: marginX, y, size: fontSize, font: normalFont });
      const apartmentTextWidth = normalFont.widthOfTextAtSize(budova, 12);
      page.drawText(budova, { x: 595 - marginX - apartmentTextWidth, y, size: 12, font: normalFont });

      y -= 25;

      const tableX = marginX;
      const col1W_label = 90;
      const col2W_value = 175;
      const col3W_label = 90;
      const col4W_value = 175;
      const rowH = 22;
      const fullTableWidth = col1W_label + col2W_value + col3W_label + col4W_value;

      // Hnědý nadpis "Vyplní zákazník" (používáme normalFont)
      const customerHeader = "Vyplní zákazník";
      const customerHeaderSize = 15;
      const customerHeaderX = tableX;
      const customerHeaderLetterSpacing = 1.5;
      page.drawText(customerHeader, {
        x: customerHeaderX,
        y: y,
        size: customerHeaderSize,
        font: normalFont,
        color: brownColor,
        letterSpacing: customerHeaderLetterSpacing
      });
      y -= 18;

      const tableStartY = y;

      const allTableRows = [
        { type: "data", label1: "Příjmení", value1: fakeData.lastName, label2: "Jméno", value2: fakeData.firstName },
        { type: "data", label1: "Adresa", value1: fakeData.address, label2: "IČ / DIČ", value2: fakeData.companyId },
        { type: "data", label1: "Email", value1: fakeData.email, label2: "Telefon", value2: fakeData.phone },
        { type: "data", label1: "Způsob platby", value1: fakeData.payment, label2: "Účel pobytu", value2: fakeData.purpose },
        { type: "data", label1: "Datum objednání", value1: orderDateCz, label2: "Termín rezervace", value2: term },
        { type: "data", label1: "Poznámka", value1: fakeData.note, merged: true },
        { type: "header", text: "Počet ubytovaných" },
        { type: "data", label1: "Muži", value1: fakeData.men, label2: "Děti (uveď věk)", value2: fakeData.children },
        { type: "data", label1: "Ženy", value1: fakeData.women, label2: "Psi", value2: fakeData.dogs },
      ];

      allTableRows.forEach((rowData, i) => {
        const yRow = tableStartY - (i + 1) * rowH;

        if (rowData.type === "data") {
          page.drawRectangle({
            x: tableX + col1W_label,
            y: yRow,
            width: col2W_value,
            height: rowH,
            color: greyFillColor,
            borderWidth: 0
          });
          if (!rowData.merged) {
            page.drawRectangle({
              x: tableX + col1W_label + col2W_value + col3W_label,
              y: yRow,
              width: col4W_value,
              height: rowH,
              color: greyFillColor,
              borderWidth: 0
            });
          }
        }

        if (rowData.type === "header") {
          const headerText = rowData.text;
          const headerTextWidth = boldFont.widthOfTextAtSize(headerText, fontSize);
          const centerX = tableX + fullTableWidth / 2 - headerTextWidth / 2;
          page.drawText(headerText, { x: centerX, y: yRow + 6, size: fontSize, font: boldFont });
        } else if (rowData.type === "data") {
          // Label text (např. "Příjmení", "Adresa") bude tučný
          page.drawText(rowData.label1, { x: tableX + 4, y: yRow + 6, size: fontSize, font: boldFont });
          // Value text (např. "Bajer", "Hnojice 98") bude normální
          page.drawText(rowData.value1, {
            x: tableX + col1W_label + 4,
            y: yRow + 6,
            size: fontSize,
            font: normalFont,
          });
          if (!rowData.merged) {
            // Label text (např. "Jméno", "IČ / DIČ") bude tučný
            page.drawText(rowData.label2, { x: tableX + col1W_label + col2W_value + 4, y: yRow + 6, size: fontSize, font: boldFont });
            // Value text (např. "Adam", "888999") bude normální
            page.drawText(rowData.value2, {
              x: tableX + col1W_label + col2W_value + col3W_label + 4,
              y: yRow + 6,
              size: fontSize,
              font: normalFont,
            });
          }
        }
      });

      y = tableStartY - allTableRows.length * rowH - 25;

      // Hnědý nadpis "Vyplní Selský Dvůr" (používáme normalFont)
      const selskydvurHeader = "Vyplní Selský Dvůr";
      const selskydvurHeaderSize = 15;
      const selskydvurHeaderX = tableX;
      page.drawText(selskydvurHeader, {
        x: selskydvurHeaderX,
        y: y,
        size: selskydvurHeaderSize,
        font: normalFont,
        color: brownColor,
        letterSpacing: customerHeaderLetterSpacing
      });
      y -= 20;

      page.drawText("Objednávka potvrzena dne:", { x: marginX, y, size: fontSize, font: normalFont });
      y -= 20;
      page.drawText("Cena objednávky stanovena na:", { x: marginX, y, size: fontSize, font: normalFont });
      page.drawText(price, { x: marginX + 180, y, size: fontSize, font: normalFont });

      // Patička (používáme normalFont)
      page.drawText("Krystoma s.r.o., Moravská Huzová 80, 783 13 Štěpánov, +420 604 471 323", {
        x: marginX, y: marginY_bottom, size: fontSize, font: normalFont, color: rgb(0, 0, 0)
      });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "ubytovani_selsky_dvur.pdf";
      a.click();
    });
  </script>
</body>
</html>